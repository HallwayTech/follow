<project name="follow" default="jar" basedir=".">

  <property name="version" value="1.5.1"/>
  <property name="jar" value="follow${version}.jar"/>

  <target name="compile">
    <mkdir dir="build/classes"/>
    <javac srcdir="src" destdir="build/classes" deprecation="yes" debug="true"/>
    <copy todir="build/classes/ghm/follow/gui">
      <fileset dir="src/ghm/follow/gui" includes="*.gif,*.png"/>
    </copy>
    <filter token="version" value="${version}"/>
    <copy todir="build/classes/ghm/follow/gui" filtering="yes">
      <fileset dir="src/ghm/follow/gui" includes="*.properties,*.prototype"/>
    </copy>
  </target>

  <target name="jar" depends="compile">
    <jar jarfile="build/${jar}" manifest="src/follow.aux">
      <fileset dir="build/classes"/>
      <fileset dir="src" includes="**/*.java"/>
      <fileset dir="." includes="LICENSE.txt,README.txt"/>
    </jar>
  </target>

  <target name="doc">
    <mkdir dir="build/javadoc"/>
    <javadoc sourcepath="src" destdir="build/javadoc"
     packagenames="ghm.follow"
     windowtitle="Follow ${version} API"
     doctitle="Generated documentation for the Follow application"/>
  </target>

  <target name="test" depends="jar">
    <mkdir dir="build/test/classes"/>
    <javac srcdir="testsrc" destdir="build/test/classes" classpath="build/${jar},lib/junit3.8.2.jar" deprecation="yes"/>
    <junit fork="yes" haltonfailure="yes" haltonerror="yes">
      <jvmarg value="-Dsun.java2d.noddraw=true"/>
      <classpath>
        <pathelement path="${java.class.path}"/>
        <pathelement location="build/${jar}"/>
        <pathelement path="build/test/classes"/>
      </classpath>
      <formatter type="plain" usefile="false"/>
      <batchtest unless="test">
        <fileset dir="testsrc" includes="**/*Test.java"/>
      </batchtest>
      <test if="test" name="${test}"/>
    </junit>
  </target>

  <target name="clean">
    <delete dir="build" quiet="true"/>
  </target>

  <target name="pristine" depends="clean">
    <delete>
      <fileset dir="${basedir}" includes="**/*~" defaultexcludes="no"/>
    </delete>
  </target>
  
  <target name="clean_build" description="Makes a clean build" depends="clean, jar"/>

  <target name="release" description="Makes a release build" depends="clean, test"/>

</project>
